{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"150232","self":"http://jira.codehaus.org/rest/api/latest/issue/150232","key":"PLXUTILS-162","fields":{"progress":{"progress":0,"total":3600,"percent":0},"summary":"Eclipse crashes while Installing JAR files on Linux","timetracking":{"originalEstimate":"1h","remainingEstimate":"1h","originalEstimateSeconds":3600,"remainingEstimateSeconds":3600},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"customfield_10110":null,"votes":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXUTILS-162/votes","votes":0,"hasVoted":false},"resolution":null,"fixVersions":[],"resolutiondate":null,"customfield_10210":"1.0","timespent":null,"reporter":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"aggregatetimeoriginalestimate":3600,"customfield_10161":["digulla(digulla)","igorfie(igorfie)","jason(jason)","krosenvold(krosenvold)"],"customfield_10160":null,"updated":"2014-01-23T11:12:15.807-0600","created":"2013-11-20T04:26:37.267-0600","description":"The Java VM has a bug which can crash a Java application when reading a corrupt JAR file.\r\n\r\nOne common scenario is running a Maven build parallel with Eclipse. Maven will write JAR files in the repository. If the build is long enough, Eclipse will start picking up those changes and start building itself.\r\n\r\nIf Eclipse happens to try to read a JAR file which Maven is currently writing, then the VM will crash. This sometimes leads to a corrupt Eclipse workspace since the caches containing information about the Java classes will now be in an inconsistent state.\r\n\r\nUsually, Eclipse does recover from those but sometimes, you end up with Eclipse being unable to navigate your Java code.\r\n\r\nThe solution is to write JAR files with a temporary name in {{FileUtils.doCopyFile()}} and rename them after copy was successful.\r\n\r\nSome considerations:\r\n\r\n- This happens on all Unix-like file systems (unlike Windows, they don't lock the file when you change it).\r\n- Not many people are affected but those who are have a hard time to figure out what is going on and how to fix it.\r\n- This bug doesn't cause data corruption but it can and does break Eclipse, making people believe that Eclipse is \"buggy\".\r\n- Writing to a temporary file does need more space on disk. But JAR files are rarely hundreds of megabytes (some WAR files are, though), so that usually shouldn't be a problem.\r\n- The fix doesn't do much on Windows but it also doesn't hurt","priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/3","iconUrl":"http://jira.codehaus.org/images/icons/priorities/major.png","name":"Major","id":"3"},"duedate":null,"issuelinks":[],"customfield_10163":"30758400","watches":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXUTILS-162/watchers","watchCount":4,"isWatching":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"subtasks":[],"status":{"self":"http://jira.codehaus.org/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/open.png","name":"Open","id":"1"},"customfield_10090":null,"labels":[],"workratio":0,"assignee":null,"attachment":[{"self":"http://jira.codehaus.org/rest/api/2/attachment/64565","id":"64565","filename":"PLXUTILS-162-JvmCrash.patch","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2013-11-21T02:40:21.436-0600","size":3637,"mimeType":"text/x-patch","content":"http://jira.codehaus.org/secure/attachment/64565/PLXUTILS-162-JvmCrash.patch"}],"customfield_10221":null,"customfield_10220":null,"customfield_10200":null,"aggregatetimeestimate":3600,"customfield_10190":null,"project":{"self":"http://jira.codehaus.org/rest/api/2/project/11432","id":"11432","key":"PLXUTILS","name":"Plexus Utils","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/projectavatar?size=xsmall&pid=11432&avatarId=10011","24x24":"http://jira.codehaus.org/secure/projectavatar?size=small&pid=11432&avatarId=10011","32x32":"http://jira.codehaus.org/secure/projectavatar?size=medium&pid=11432&avatarId=10011","48x48":"http://jira.codehaus.org/secure/projectavatar?pid=11432&avatarId=10011"},"projectCategory":{"self":"http://jira.codehaus.org/rest/api/2/projectCategory/10003","id":"10003","description":"various containers","name":"containers"}},"versions":[{"self":"http://jira.codehaus.org/rest/api/2/version/19535","id":"19535","name":"3.0.15","archived":false,"released":true,"releaseDate":"2013-08-19"}],"customfield_10170":null,"environment":null,"timeestimate":3600,"customfield_10130":null,"aggregateprogress":{"progress":0,"total":3600,"percent":0},"lastViewed":null,"components":[],"comment":{"startAt":0,"maxResults":22,"total":22,"comments":[{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/336040","id":"336040","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"I have a patch but I can't access Github from my workplace. Should I post it here (it's an additional method + 1 line of original code that you need to change, so applying it manually will take only a few seconds)?","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2013-11-20T04:28:45.943-0600","updated":"2013-11-20T04:28:45.943-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/336045","id":"336045","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"body":"You can post it here as plain text","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"created":"2013-11-20T05:17:52.888-0600","updated":"2013-11-20T05:17:52.888-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/336092","id":"336092","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"Patch which applies cleanly against b38a1b3a4352303e4312b2bb601a0d7ec6e28f41","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2013-11-21T02:40:21.458-0600","updated":"2013-11-21T02:40:21.458-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/336093","id":"336093","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"Instructions for people who need a this fix quickly:\r\n\r\n# Checkout plexus-utils from https://github.com/sonatype/plexus-utils\r\n# Apply the attached patch\r\n# mvn install\r\n# Change your parent pom and add this to the {{pluginManagement}}:\r\n\r\n{code}\r\n<plugin>\r\n    <groupId>org.apache.maven.plugins</groupId>\r\n    <artifactId>maven-install-plugin</artifactId>\r\n    <version>2.5.1</version>\r\n    \r\n    <dependencies>\r\n        <dependency>\r\n            <groupId>org.codehaus.plexus</groupId>\r\n            <artifactId>plexus-utils</artifactId>\r\n            <version>3.0.16-SNAPSHOT</version>\r\n        </dependency>\r\n    </dependencies>\r\n</plugin>\r\n{code}\r\n","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2013-11-21T02:43:24.485-0600","updated":"2013-11-21T02:43:24.485-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/336313","id":"336313","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"Note: I would prefer a solution where the install plugin would create a temporary folder for all artifacts and then makes them all visible to consumers with a single rename but looking at the code of the plugin, I didn't see a simple solution to achieve that.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2013-11-25T07:41:06.052-0600","updated":"2013-11-25T07:41:06.052-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/336525","id":"336525","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"Any feedback on this one? Is the patch good/bad?","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2013-11-29T04:14:18.689-0600","updated":"2013-11-29T04:14:18.689-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/336531","id":"336531","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"body":"This patch is definitely not going in as standard behaviour for copyFile. We might consider making atomicCopyFile public instead and use this from the proper place instead. I will try to take a closer look at this issue this weekend","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"created":"2013-11-29T05:51:06.760-0600","updated":"2013-11-29T05:51:06.760-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/336647","id":"336647","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"Please share your reasons for this decision. From my experience, the original code causes subtle bugs that are really hard to track down and reproduce (like incomplete files when free space gets tight or corrupt files on non-locking file systems).","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2013-12-03T03:31:38.880-0600","updated":"2013-12-03T03:31:38.880-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/336727","id":"336727","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"body":"copyFile is a generic file copy function; adding this behavior there is too much of a hack and it would come into effect in numerous other (unintended) places.\r\n\r\nAre you using maven 2.2.1 ? The install logic in 3.X does not appear to be using this library at all (to my knowledge it uses org.apache.maven.artifact.installer.DefaultArtifactInstaller#install and DefaultFileProcessor#copy in aether)","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"created":"2013-12-04T00:58:43.487-0600","updated":"2013-12-04T00:58:43.487-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338220","id":"338220","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"Sorry for the long delay; I was on holidays.\r\n\r\nFirst of all, in the mind of many developers, \"copy\" is assumed to be atomic. It really isn't and most people know this but it often takes a bug like this one to remind them to handle this case correctly.\r\n\r\nSecondly, copy really should be atomic - there is not a single use case where it being non-atomic makes sense. Streaming isn't copying - when I write to stdout, I don't expect all the output to become visible to the consumers all at once. But Stackoverflow.com is full of questions \"how can I know that a process has finished writing a file\" which indicates to me that the current default behavior of all programming languages is bad.\r\n\r\nLastly, while it slightly changes the behavior of a lot of code, I would be interesting in any scenarios where my patch could actually break anything. As I said, it does waste a bit of disk space but it does clean up after itself properly.\r\n\r\nSo for me, you saying \"it's a hack\" feels like you don't want to say \"I'm afraid what this change might cause\".\r\n\r\nI'm using Maven 3.0.5 with the maven-install-plugin 2.5.1. When I run mvn with -X, I see that my version of plexus-utils is picked up.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2014-01-08T04:10:01.310-0600","updated":"2014-01-08T04:10:01.310-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338228","id":"338228","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"body":"Just do the right thing and I can assure you all the patches will be applied. ","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"created":"2014-01-08T05:16:27.117-0600","updated":"2014-01-08T05:16:27.117-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338239","id":"338239","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"I had a look at the sources once more. In my case, {{DefaultArtifactInstaller}} from {{~/.m2/repository/org/apache/maven/maven-artifact-manager/2.0.6/maven-artifact-manager-2.0.6.jar}} is being used when I open the source in Eclipse.\r\n\r\nLine 32 reads: {{FileUtils.copyFile( source, destination );}}\r\n\r\nAs for \"just do the right thing\": I use hundreds of OSS projects every day and I simply can't afford to learn the rules of each one of them. So it's either filing bug reports and getting some love back or giving up for me :-)\r\n\r\nAlong the same lines, it doesn't help that your \"right thing\" will never be my \"right thing.\"","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2014-01-08T06:45:07.740-0600","updated":"2014-01-08T07:09:28.029-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338303","id":"338303","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=igorfie","name":"igorfie","emailAddress":"igor@ifedorenko.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Igor Fedorenko","active":true},"body":"I am on the fence about this patch. On one hand, I agree with Aaron that all users FileUtils.copyFile expect atomic behaviour. On the other hand, I don't believe the attached patch covers all interesting cases. I am particularly concerned about concurrent invocation of FileUtils.copyFile from multiple threads/processes for the same destination file. Cleanup after process crashes is another concern.\r\n\r\nI am also not sure I understand the purpose of backup file. This seems like new and unexpected feature.\r\n\r\nAlso, I wonder if we can use jdk7 atomic move, without breaking compatibility with earlier java versions of course.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=igorfie","name":"igorfie","emailAddress":"igor@ifedorenko.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Igor Fedorenko","active":true},"created":"2014-01-09T07:03:18.586-0600","updated":"2014-01-09T07:03:18.586-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338309","id":"338309","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jason","name":"jason","emailAddress":"jason@takari.io","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jason van Zyl","active":true},"body":"Or just slowly replace the code in Plexus with Guava. I just ran into a concurrency issue in FileUtils.copyDirectory a couple days ago and replaced it with some Guava code and it was fine. If we're going to slowly get rid of Plexus we should use Guava (that's my strong preference) or Commons code. This stuff has been fixed elsewhere. Definitely in Guava.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jason","name":"jason","emailAddress":"jason@takari.io","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jason van Zyl","active":true},"created":"2014-01-09T08:27:49.511-0600","updated":"2014-01-09T08:27:49.511-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338310","id":"338310","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=igorfie","name":"igorfie","emailAddress":"igor@ifedorenko.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Igor Fedorenko","active":true},"body":"Do you suggest adding Guava as plexus-utils dependency (possible shaded, to avoid conflicts)? Otherwise it is up to individual plexus-utils consumers to migrate and we still need to support existing clients.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=igorfie","name":"igorfie","emailAddress":"igor@ifedorenko.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Igor Fedorenko","active":true},"created":"2014-01-09T09:06:53.930-0600","updated":"2014-01-09T09:06:53.930-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338311","id":"338311","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"Re multi-threading: It's rare that a low-level helper function can handle the necessary locking for multiple threads. I think this would be a nice thing to have but clearly out of scope here unless we completely revamp the API.\r\n\r\nThe purpose of the backup file is to be able to roll back several copies if one of them fails. It's useless in the patch and can be removed - I just copied the code from my source base and massaged it a bit for your API.\r\n\r\nBut if we think that installing an artifact with all the related files is one atomic operation, then using backup files would allow us to write each file individually (instead of having to synchronize all the writes and then rename all of them in one loop in a postprocessor).\r\n\r\nGuava's {{Files.copy()}} also isn't atomic but it's easier to fix; a custom {{OutputSupplier}} would solve the issue.\r\n\r\nAs a side note: I use my own {{File*Stream}} and similar classes which keep a copy of the file name so I can create better error messages. But I felt that such a change would be way too disruptive, so I didn't mention it before.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2014-01-09T09:10:58.156-0600","updated":"2014-01-09T09:10:58.156-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338312","id":"338312","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=igorfie","name":"igorfie","emailAddress":"igor@ifedorenko.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Igor Fedorenko","active":true},"body":"I think using File.createTempFile(destination.getName(), \".tmp\", destination.getParentFile()) together with jdk7 atomic move will make this multi- thread/process safe without changing API.  Everyone is using jdk7 anyways, so degraded behaviour on older java versions is mostly a theoretical problem at this point.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=igorfie","name":"igorfie","emailAddress":"igor@ifedorenko.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Igor Fedorenko","active":true},"created":"2014-01-09T09:34:47.645-0600","updated":"2014-01-09T09:34:47.645-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338314","id":"338314","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jason","name":"jason","emailAddress":"jason@takari.io","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jason van Zyl","active":true},"body":"@Aaron, where Plexus failed Guava worked for me in a highly concurrent build. I didn't look at the code in Guava it just tends to work for me.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jason","name":"jason","emailAddress":"jason@takari.io","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jason van Zyl","active":true},"created":"2014-01-09T10:01:54.548-0600","updated":"2014-01-09T10:01:54.548-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338322","id":"338322","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"@Igor: We just barely upgraded from Java 5, so I resent your comment :-) Some of our customers complain for our lack of support for Java 1.4.\r\n\r\n{{File.createTempFile()}} sounds like a nice idea; only my experience is that a bug prevents the rename of the temp file (Windows loves to keep a lock on temp files) and then your target folder fills up with temporary files. My version is more simple and it eventually cleans up temporary files.\r\n\r\n@Jason: Yes, Guava solves a lot of problems. We're also migrating to it. But I have already seen a few of places where theory and OO religion was more important than practice, so I'm not a 100% dedicated fan of it anymore.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2014-01-09T10:31:44.264-0600","updated":"2014-01-09T10:31:44.264-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338325","id":"338325","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"body":"Guava might be nice, but to be honest solving this issue in p-u is a bit of a lost cause. \r\n\r\nThe *real* problem that should be fixed is that whatever eclipse code you're using should be updated to use a maven 3.1+ implementation. Even then, the underlying file copy problem needs to be solved for aether, since the same problem still exists in aether (which uses its own internal file-copy code btw :).\r\n\r\nThe code you're using uses maven 2.0.9, and that oldest version one could *hope* to be patched is a future maven 2.2.2. Even then, the 2.2.X range is mostly being patched for security fixes, which might even mean the plexus-utils upgrade might be skipped. If we apply anything like this patch to plexus-utils it would be at least version 3.0.16 (which has a jdk 1.5 requirement).\r\n\r\n","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"created":"2014-01-09T11:04:10.777-0600","updated":"2014-01-09T11:04:10.777-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/338599","id":"338599","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"I need some help to come up with a new patch. When I check out maven-install-plugin 2.5.1, then there is no dependency on anything called \"aether\". What's aether, where can I find it and where is the connection between it and the install plugin?","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2014-01-13T04:59:00.713-0600","updated":"2014-01-13T04:59:00.713-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/150232/comment/339890","id":"339890","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"body":"@Kristian: I think you still misunderstand what this bug is about. Aether (as in the Eclipse plugin) is not involved. In fact, you can achieve the same result by starting Eclipse and creating project which depends on a JAR file on the hard disk.\r\n\r\nIf you create a shell script which copies over the JAR file in a loop, the Java VM will eventually crash. Any Java program that accesses JAR files is vulnerable to this. It's a bug in the code which reads ZIP archives when the ZIP archive is corrupt.\r\n\r\nIt's not limited to Eclipse, it's not related to the m2e plugin.\r\n\r\nThe code I patched is used in Maven 3.0.x. If I add a `System.out.println()` in plexus-utils, then I see it when I run Maven from the command line.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla@hepe.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Aaron Digulla","active":true},"created":"2014-01-23T11:11:13.678-0600","updated":"2014-01-23T11:12:15.535-0600"}]},"timeoriginalestimate":3600,"aggregatetimespent":null}}