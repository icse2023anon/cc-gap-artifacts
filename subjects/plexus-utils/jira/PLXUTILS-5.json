{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"35108","self":"http://jira.codehaus.org/rest/api/latest/issue/35108","key":"PLXUTILS-5","fields":{"progress":{"progress":0,"total":0},"summary":"empty <excludes/> removes the directory of the fileset","timetracking":{},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"customfield_10110":{"self":"http://jira.codehaus.org/rest/api/2/customFieldOption/10040","value":"yes","id":"10040"},"votes":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXUTILS-5/votes","votes":0,"hasVoted":false},"resolution":{"self":"http://jira.codehaus.org/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"fixVersions":[],"resolutiondate":"2014-11-25T14:30:42.302-0600","customfield_10210":"0.0","timespent":null,"reporter":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jesse","name":"jesse","emailAddress":"jesse.mcconnell@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jesse McConnell","active":true},"aggregatetimeoriginalestimate":null,"customfield_10161":["brettporter(brettporter)","jesse(jesse)","michael-o(michael-o)"],"customfield_10160":null,"updated":"2014-11-25T14:30:42.354-0600","created":"2006-03-21T09:39:00.687-0600","description":"I was shifting the unit tests over to use the plugin harness and noticed a test case failing.\n\nif you look at the test case for the fileset test case, the second fileset test has an addFileset(dir, \"**\", \"\");\n\nthis unit test works fine, but when you try and actually do this behavior using the plugin configuration it brings up an error\n\n            <fileset>\n              <directory>${basedir}/target/test-classes/fileset-clean-test/buildOutputDirectory</directory>\n              <includes>\n                <include>**</include>\n              </includes>\n            </fileset>\n\nthat would be the plugin configuration of the same deal.  (<exclude></exclude> results in a stack trace)\n\nIn this case the directory is getting deleted when configured.  You can exhibit the same behavior with the existing test case if you try and pass null into the addFileset signature...\n\n\nthis would be the failing test case using the existing plugin, note the null in the second addFileset()\n------\n\n public void testFilesets()\n        throws Exception\n    {\n        String base = TARGET_TEST_DIR + \"/target\";\n\n        CleanMojo mojo = new CleanMojo();\n\n        mojo.addFileset( createFileset( base, \"**/file.txt\", \"**/subdir/**\" ) );\n\n        String outputDirectory = TARGET_TEST_DIR + \"/buildOutputDirectory\";\n        mojo.addFileset( createFileset( outputDirectory, \"**\", null ) );\n\n        mojo.execute();\n\n        // fileset 1\n        assertTrue( checkExists( base ) );\n        assertTrue( checkExists( base + \"/classes\" ) );\n        assertFalse( checkExists( base + \"/classes/file.txt\" ) );\n/* TODO: looks like a bug in the file-management library\n        assertTrue( FileUtils.fileExists( base + \"/subdir/file.txt\" ) );\n*/\n\n        // fileset 2\n        assertTrue( checkExists( outputDirectory ) );\n        assertFalse( checkExists( outputDirectory + \"/file.txt\" ) );\n\tSystem.exit(-1);\n    }\n\n","priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/3","iconUrl":"http://jira.codehaus.org/images/icons/priorities/major.png","name":"Major","id":"3"},"duedate":null,"issuelinks":[],"customfield_10163":"4320000","watches":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXUTILS-5/watchers","watchCount":1,"isWatching":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"subtasks":[],"status":{"self":"http://jira.codehaus.org/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/closed.png","name":"Closed","id":"6"},"customfield_10090":null,"labels":[],"workratio":-1,"assignee":null,"attachment":[],"customfield_10221":null,"customfield_10220":null,"customfield_10200":null,"aggregatetimeestimate":null,"customfield_10190":null,"project":{"self":"http://jira.codehaus.org/rest/api/2/project/11432","id":"11432","key":"PLXUTILS","name":"Plexus Utils","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/projectavatar?size=xsmall&pid=11432&avatarId=10011","24x24":"http://jira.codehaus.org/secure/projectavatar?size=small&pid=11432&avatarId=10011","32x32":"http://jira.codehaus.org/secure/projectavatar?size=medium&pid=11432&avatarId=10011","48x48":"http://jira.codehaus.org/secure/projectavatar?pid=11432&avatarId=10011"},"projectCategory":{"self":"http://jira.codehaus.org/rest/api/2/projectCategory/10003","id":"10003","description":"various containers","name":"containers"}},"versions":[],"customfield_10170":null,"environment":null,"timeestimate":null,"customfield_10130":null,"aggregateprogress":{"progress":0,"total":0},"lastViewed":null,"components":[],"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"http://jira.codehaus.org/rest/api/2/issue/35108/comment/61731","id":"61731","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jesse","name":"jesse","emailAddress":"jesse.mcconnell@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jesse McConnell","active":true},"body":"the jist of the problem is that when the excludes is set to \"\" then that is translating to 'don't remove the directory' of the fileset\r\n\r\nperhaps the thing to do is add the \"\" to the default excludes?","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jesse","name":"jesse","emailAddress":"jesse.mcconnell@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jesse McConnell","active":true},"created":"2006-03-22T17:22:52.302-0600","updated":"2006-03-22T17:22:52.302-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/35108/comment/61796","id":"61796","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jesse","name":"jesse","emailAddress":"jesse.mcconnell@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jesse McConnell","active":true},"body":"ok, the setting the fileset to null above seems to throw the same exception now that using an empty excludes statement does...\r\n\r\nblows on line 502 of DirectoryScanner when setting excludes.\r\n\r\nnow...\r\n\r\n<excludes><exclude></exclude><excludes> blows up and have the excludes as an arraylist of size 1 and null inside..\r\n\r\nnot having the excludes and just the includes yields an arraylist of size 0 and removes the directory..\r\n\r\nand the existing unit test ends up with a excludes arraylist of size 1 with a \"\" element inside.. (which is the only one that passes unit test atm)\r\n\r\n","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jesse","name":"jesse","emailAddress":"jesse.mcconnell@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jesse McConnell","active":true},"created":"2006-03-23T11:46:51.582-0600","updated":"2006-03-23T11:46:51.582-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/35108/comment/61804","id":"61804","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jesse","name":"jesse","emailAddress":"jesse.mcconnell@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jesse McConnell","active":true},"body":"Not sure what to do here...\r\n\r\nthe original test case used the \"**\" includes and \"\" excludes which exhibited the desired behavior...\r\n\r\nNow it would seem to me that \r\n\r\n<fileset>\r\n  <includes>\r\n    <include>**</include>\r\n  </includes>\r\n</fileset>\r\n\r\nnow to me that would be the same thing, but DirectoryScanner specificaly looks for \"\" in the exclude to decide if the directory should be deleted.\r\n\r\n<fileset>\r\n  <includes>\r\n    <include>**</include>\r\n  </includes>\r\n  <excludes>\r\n    <exclude></exclude>\r\n  </excludes>\r\n</fileset>\r\n\r\nNow this builds an excludes arraylist of size 1 but null inside, which triggers a NPE in DirectoryScanner..\r\n\r\n<fileset>\r\n  <includes>\r\n    <include>**</include>\r\n  </includes>\r\n  <excludes>\r\n    <exclude>\"\"</exclude>\r\n  </excludes>\r\n</fileset>\r\n\r\nThis certainly doesn't work since it translate to \"\\\"\\\"\" in the fileset\r\n\r\nBUT!\r\n\r\n<fileset>\r\n  <includes>\r\n    <include>**</include>\r\n  </includes>\r\n  <excludes>\r\n    <exclude>**</exclude>\r\n  </excludes>\r\n</fileset>\r\n\r\ndoes exhibit the correct behavior, since the includes ** matchs the files in the directory and the ** actually seems to protect the directory.  The files end up getting smoked but the base directory of the fileset is perserved.\r\n\r\nThis seems a bit off to me, but I am able to configure a fileset that exhibits the same end behavior of the test case...but this feels like another issue to me, that ** in includes means something other then ** in excludes.\r\n","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jesse","name":"jesse","emailAddress":"jesse.mcconnell@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jesse McConnell","active":true},"created":"2006-03-23T14:00:16.330-0600","updated":"2006-03-23T14:00:16.330-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/35108/comment/61873","id":"61873","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=brettporter","name":"brettporter","emailAddress":"brett@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Brett Porter","active":true},"body":"I think we should scratch this issue. To me <excludes/> == <excludes></excludes> == null, that is, exclude nothing.\r\n\r\nThe bug should be filed against plexus-utils / file management API (if appropriate). Perhaps we should rebase DirectoryScanner against the latest from Ant to see if such bugs have been fixed. Anyway, not a big issue.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=brettporter","name":"brettporter","emailAddress":"brett@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Brett Porter","active":true},"created":"2006-03-24T06:06:08.219-0600","updated":"2006-03-24T06:06:08.219-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/35108/comment/61915","id":"61915","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jesse","name":"jesse","emailAddress":"jesse.mcconnell@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jesse McConnell","active":true},"body":"moved this issue from the clean plugin...\r\n\r\nthe crux of the issue is that \"\" as the excludes detection in the DirectoryScanner doesn't map out to an xml configuration, the way to get around it was to use and include of ** and an exclude of ** which is interesting in that the ** seem to mean to different things in both includes and excludes.\r\n\r\nThis should be against file-management API but I don't rights to tweak.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jesse","name":"jesse","emailAddress":"jesse.mcconnell@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jesse McConnell","active":true},"created":"2006-03-24T15:57:59.854-0600","updated":"2006-03-24T15:57:59.854-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/35108/comment/357284","id":"357284","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=michael-o","name":"michael-o","emailAddress":"1983-01-06@gmx.net","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Michael Osipov","active":true},"body":"Please refer to https://cwiki.apache.org/confluence/display/MAVEN/The+Great+JIRA+Cleanup+of+2014 if you're wondering why this issue was closed out.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=michael-o","name":"michael-o","emailAddress":"1983-01-06@gmx.net","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Michael Osipov","active":true},"created":"2014-11-25T14:30:42.334-0600","updated":"2014-11-25T14:30:42.334-0600"}]},"timeoriginalestimate":null,"aggregatetimespent":null}}