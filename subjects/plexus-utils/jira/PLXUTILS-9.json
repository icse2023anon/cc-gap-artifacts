{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"36231","self":"http://jira.codehaus.org/rest/api/latest/issue/36231","key":"PLXUTILS-9","fields":{"progress":{"progress":0,"total":0},"summary":"PlexusUtils.getSystemEnvVars doesn't clean up resources","timetracking":{},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"customfield_10110":null,"votes":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXUTILS-9/votes","votes":0,"hasVoted":false},"resolution":{"self":"http://jira.codehaus.org/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"fixVersions":[],"resolutiondate":"2006-04-21T11:47:21.192-0500","customfield_10210":"0.0","timespent":null,"reporter":{"self":"http://jira.codehaus.org/rest/api/2/user?username=lacostej","name":"lacostej","emailAddress":"jerome.lacoste@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jerome Lacoste","active":true},"aggregatetimeoriginalestimate":null,"customfield_10161":["lacostej(lacostej)"],"customfield_10160":null,"updated":"2007-01-13T01:01:53.452-0600","created":"2006-04-21T11:06:00.641-0500","description":"Using the embedder I am hitting the following issue;\n\njava    7399 jerome    7u  sock      0,4          25306792 can't identify protocol\njava    7399 jerome    8u  IPv6 25306796               TCP *:8181 (LISTEN)\njava    7399 jerome    9r   REG     3,66       90    34656 /home/jerome/.mailcap\njava    7399 jerome   10w  FIFO      0,5          25416706 pipe\njava    7399 jerome   11w  FIFO      0,5          25436577 pipe\njava    7399 jerome   12w  FIFO      0,5          25320121 pipe\njava    7399 jerome   13r  FIFO      0,5          25320122 pipe\njava    7399 jerome   14w  FIFO      0,5          25328530 pipe\njava    7399 jerome   15r  FIFO      0,5          25320123 pipe\njava    7399 jerome   16w  FIFO      0,5          25315686 pipe\njava    7399 jerome   17r  FIFO      0,5          25315687 pipe\njava    7399 jerome   18w  FIFO      0,5          25320126 pipe\njava    7399 jerome   19r  FIFO      0,5          25315688 pipe\njava    7399 jerome   20r  FIFO      0,5          25320127 pipe\njava    7399 jerome   21r  FIFO      0,5          25328531 pipe\njava    7399 jerome   22r  FIFO      0,5          25320128 pipe\n\n[...]\n\njava    7399 jerome 1007r  FIFO      0,5          26391458 pipe\njava    7399 jerome 1008r  FIFO      0,5          26416550 pipe\njava    7399 jerome 1009w  FIFO      0,5          26421728 pipe\njava    7399 jerome 1010r  FIFO      0,5          26416551 pipe\njava    7399 jerome 1011r  FIFO      0,5          26421729 pipe\njava    7399 jerome 1012w  FIFO      0,5          26421776 pipe\njava    7399 jerome 1013r  FIFO      0,5          26421730 pipe\njava    7399 jerome 1014r  FIFO      0,5          26421777 pipe\njava    7399 jerome 1015w  FIFO      0,5          26425995 pipe\njava    7399 jerome 1016r  FIFO      0,5          26421778 pipe\njava    7399 jerome 1017r  FIFO      0,5          26425996 pipe\njava    7399 jerome 1019r  FIFO      0,5          26425997 pipe\njava    7399 jerome 1020r  FIFO      0,5          26434244 pipe\n\n\nException in thread \"Thread-1796\" java.io.IOException: java.io.IOException: Too many open files\n        at java.lang.UNIXProcess.<init>(UNIXProcess.java:148)\n        at java.lang.ProcessImpl.start(ProcessImpl.java:65)\n        at java.lang.ProcessBuilder.start(ProcessBuilder.java:451)\n        at java.lang.Runtime.exec(Runtime.java:591)\n        at java.lang.Runtime.exec(Runtime.java:429)\n        at java.lang.Runtime.exec(Runtime.java:326)\n        at org.codehaus.plexus.util.cli.CommandLineUtils.getSystemEnvVars(CommandLineUtils.java:177)\n        at org.apache.maven.project.interpolation.RegexBasedModelInterpolator.<init>(RegexBasedModelInterpolator.java:60)\n        at sun.reflect.GeneratedConstructorAccessor56.newInstance(Unknown Source)\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:494)\n        at java.lang.Class.newInstance0(Class.java:350)\n        at java.lang.Class.newInstance(Class.java:303)\n        at org.codehaus.plexus.component.factory.java.JavaComponentFactory.newInstance(JavaComponentFactory.java:44)\n        at org.codehaus.plexus.DefaultPlexusContainer.createComponentInstance(DefaultPlexusContainer.java:1464)\n        at org.codehaus.plexus.component.manager.AbstractComponentManager.createComponentInstance(AbstractComponentManager.java:93)\n        at org.codehaus.plexus.component.manager.ClassicSingletonComponentManager.getComponent(ClassicSingletonComponentManager.java:92)\n        at org.codehaus.plexus.DefaultPlexusContainer.lookup(DefaultPlexusContainer.java:331)\n        at org.codehaus.plexus.component.composition.FieldComponentComposer.assignRequirementToField(FieldComponentComposer.java:129)\n        at org.codehaus.plexus.component.composition.FieldComponentComposer.assembleComponent(FieldComponentComposer.java:73)\n        at org.codehaus.plexus.component.composition.DefaultComponentComposerManager.assembleComponent(DefaultComponentComposerManager.java:68)\n        at org.codehaus.plexus.DefaultPlexusContainer.composeComponent(DefaultPlexusContainer.java:1486)\n        at org.codehaus.plexus.personality.plexus.lifecycle.phase.CompositionPhase.execute(CompositionPhase.java:29)\n        at org.codehaus.plexus.lifecycle.AbstractLifecycleHandler.start(AbstractLifecycleHandler.java:101)\n        at org.codehaus.plexus.component.manager.AbstractComponentManager.startComponentLifecycle(AbstractComponentManager.java:105)        at org.codehaus.plexus.component.manager.AbstractComponentManager.createComponentInstance(AbstractComponentManager.java:95)\n        at org.codehaus.plexus.component.manager.ClassicSingletonComponentManager.getComponent(ClassicSingletonComponentManager.java:92)\n        at org.codehaus.plexus.DefaultPlexusContainer.lookup(DefaultPlexusContainer.java:331)\n        at org.codehaus.plexus.embed.Embedder.lookup(Embedder.java:78)\n        at org.apache.maven.embedder.MavenEmbedder.start(MavenEmbedder.java:610)\n[...]\n\n\nThe aforementionned method doesn't clean up the Process resources. Blocker as it makes it impossible to reuse the embedder.","priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/1","iconUrl":"http://jira.codehaus.org/images/icons/priorities/blocker.png","name":"Blocker","id":"1"},"duedate":null,"issuelinks":[],"customfield_10163":"275616000","watches":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXUTILS-9/watchers","watchCount":0,"isWatching":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"subtasks":[],"status":{"self":"http://jira.codehaus.org/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/closed.png","name":"Closed","id":"6"},"customfield_10090":null,"labels":[],"workratio":-1,"assignee":null,"attachment":[],"customfield_10221":null,"customfield_10220":null,"customfield_10200":null,"aggregatetimeestimate":null,"customfield_10190":null,"project":{"self":"http://jira.codehaus.org/rest/api/2/project/11432","id":"11432","key":"PLXUTILS","name":"Plexus Utils","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/projectavatar?size=xsmall&pid=11432&avatarId=10011","24x24":"http://jira.codehaus.org/secure/projectavatar?size=small&pid=11432&avatarId=10011","32x32":"http://jira.codehaus.org/secure/projectavatar?size=medium&pid=11432&avatarId=10011","48x48":"http://jira.codehaus.org/secure/projectavatar?pid=11432&avatarId=10011"},"projectCategory":{"self":"http://jira.codehaus.org/rest/api/2/projectCategory/10003","id":"10003","description":"various containers","name":"containers"}},"versions":[],"customfield_10170":null,"environment":null,"timeestimate":null,"customfield_10130":null,"aggregateprogress":{"progress":0,"total":0},"lastViewed":null,"components":[],"comment":{"startAt":0,"maxResults":1,"total":1,"comments":[{"self":"http://jira.codehaus.org/rest/api/2/issue/36231/comment/63947","id":"63947","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=lacostej","name":"lacostej","emailAddress":"jerome.lacoste@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jerome Lacoste","active":true},"body":"I wasn't able to reproduce it yet. I've used the following code snippet from kenney\r\n\r\nimport java.io.*;\r\n\r\npublic class TestIt\r\n{\r\n    public static void main(String argv[])\r\n        throws java.io.IOException, InterruptedException\r\n    {\r\n        for ( int i = 0; ; i++)\r\n        {\r\n            if ( i % 10 == 0 )\r\n              System.out.println( i );\r\n//            Thread.sleep(50);\r\n/*            new Thread(new Runnable() {\r\n              public void run() {\r\n                try {\r\n*/\r\n                test();\r\n/*                } catch (Exception e) {\r\n                e.printStackTrace();\r\n                }\r\n              }\r\n            }).start();\r\n*/\r\n        }\r\n    }\r\n\r\n    private static void test()\r\n        throws java.io.IOException\r\n    {\r\n            Process p = Runtime.getRuntime().exec(\"env | cat\");\r\n            BufferedReader br = new BufferedReader( new InputStreamReader( p.getInputStream() ) );\r\n            while (br.readLine() != null ) {}\r\n\r\n    }\r\n}\r\n\r\n\r\nIt ran up to 40k without issues. I tried adding threads but that didn't trigger it.  I monitored the number of open descriptors and it went between 1 and 650. My limit is 1024.\r\n\r\nDoing:\r\n\r\nulimit -n 500 && java TestIt reproduced the issue easily but that's kind of cheating :)\r\n\r\n\r\nMaybe another part of the system generates these pipes and they are uncovered by this call? I will close the issue until I find the real culprit...\r\n\r\nFor reference: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4784692","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=lacostej","name":"lacostej","emailAddress":"jerome.lacoste@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jerome Lacoste","active":true},"created":"2006-04-21T11:46:53.227-0500","updated":"2006-04-21T11:46:53.227-0500"}]},"timeoriginalestimate":null,"aggregatetimespent":null}}