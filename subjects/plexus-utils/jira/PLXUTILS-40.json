{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"54267","self":"http://jira.codehaus.org/rest/api/latest/issue/54267","key":"PLXUTILS-40","fields":{"progress":{"progress":0,"total":0},"summary":"shutdown hook in CommandLineUtils does not kill process with GUI on windows","timetracking":{},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"customfield_10110":null,"votes":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXUTILS-40/votes","votes":6,"hasVoted":false},"resolution":null,"fixVersions":[],"resolutiondate":null,"customfield_10210":"0.0","timespent":null,"reporter":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jaxzin","name":"jaxzin","emailAddress":"brian@jaxzin.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Brian Jackson","active":true},"aggregatetimeoriginalestimate":null,"customfield_10161":["bentmann(bentmann)","jaxzin(jaxzin)","fj(fj)","jan.sievers(jan.sievers)","krosenvold(krosenvold)","mkleint(mkleint)"],"customfield_10160":null,"updated":"2014-02-12T07:52:38.189-0600","created":"2007-07-24T22:50:48.651-0500","description":"Calling executeCommandLine(\"notepad\", new MyStreamConsumer(), new MyStreamConsumer()) on Windows and then Ctrl-C the process.  Notepad is left running in background.  Problem also exists for long running java processes.","priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/3","iconUrl":"http://jira.codehaus.org/images/icons/priorities/major.png","name":"Major","id":"3"},"duedate":null,"issuelinks":[{"id":"23586","self":"http://jira.codehaus.org/rest/api/2/issueLink/23586","type":{"id":"10010","name":"Related","inward":"is related to","outward":"relates to","self":"http://jira.codehaus.org/rest/api/2/issueLinkType/10010"},"outwardIssue":{"id":"89238","key":"MNG-4229","self":"http://jira.codehaus.org/rest/api/2/issue/89238","fields":{"summary":"ctrl+c interrupted maven junit tests don't actually get interrupted in windows","status":{"self":"http://jira.codehaus.org/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/closed.png","name":"Closed","id":"6"},"priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/4","iconUrl":"http://jira.codehaus.org/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"33940","self":"http://jira.codehaus.org/rest/api/2/issueLink/33940","type":{"id":"10010","name":"Related","inward":"is related to","outward":"relates to","self":"http://jira.codehaus.org/rest/api/2/issueLinkType/10010"},"outwardIssue":{"id":"148610","key":"MSHARED-295","self":"http://jira.codehaus.org/rest/api/2/issue/148610","fields":{"summary":"Non reliable killing of processes by CommandLineUtils","status":{"self":"http://jira.codehaus.org/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/open.png","name":"Open","id":"1"},"priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/3","iconUrl":"http://jira.codehaus.org/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_10163":"29116800","watches":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXUTILS-40/watchers","watchCount":7,"isWatching":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"subtasks":[],"status":{"self":"http://jira.codehaus.org/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/open.png","name":"Open","id":"1"},"customfield_10090":null,"labels":[],"workratio":-1,"assignee":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"attachment":[],"customfield_10221":null,"customfield_10220":null,"customfield_10200":null,"aggregatetimeestimate":null,"customfield_10190":null,"project":{"self":"http://jira.codehaus.org/rest/api/2/project/11432","id":"11432","key":"PLXUTILS","name":"Plexus Utils","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/projectavatar?size=xsmall&pid=11432&avatarId=10011","24x24":"http://jira.codehaus.org/secure/projectavatar?size=small&pid=11432&avatarId=10011","32x32":"http://jira.codehaus.org/secure/projectavatar?size=medium&pid=11432&avatarId=10011","48x48":"http://jira.codehaus.org/secure/projectavatar?pid=11432&avatarId=10011"},"projectCategory":{"self":"http://jira.codehaus.org/rest/api/2/projectCategory/10003","id":"10003","description":"various containers","name":"containers"}},"versions":[],"customfield_10170":null,"environment":"Windows XP SP2\nMaven 2.0.7\nplexus-utils 1.1-beta-2","timeestimate":null,"customfield_10130":null,"aggregateprogress":{"progress":0,"total":0},"lastViewed":null,"components":[],"comment":{"startAt":0,"maxResults":4,"total":4,"comments":[{"self":"http://jira.codehaus.org/rest/api/2/issue/54267/comment/142531","id":"142531","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=bentmann","name":"bentmann","emailAddress":"benjamin.bentmann@udo.edu","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Benjamin Bentmann","active":true},"body":"As described in the API docs for {{CommandLineUtils.killProcess()}} this is not possible due to a limitation of the Windows process model, compare [Sun Bug ID 4770092|http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4770092].\r\n\r\nYou could try out the upcoming [Commons Exec|http://commons.apache.org/exec/] which to my knowledge launches programs directly instead of using \"cmd.exe\". Taking this intermediate process out of the game might at least make your scenaria with Notepad work.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=bentmann","name":"bentmann","emailAddress":"benjamin.bentmann@udo.edu","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Benjamin Bentmann","active":true},"created":"2008-07-20T13:51:10.672-0500","updated":"2008-07-20T13:51:10.672-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/54267/comment/170984","id":"170984","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=mkleint","name":"mkleint","emailAddress":"mkleint@codehaus.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Milos Kleint","active":true},"body":"Actually I seem to have problems with it even on linux. it seems the only way that kills a running test for example is Ctrl-C on console. Sending appropriate (I've tried many) signals to the maven build only kills the build but the test keeps running. Sometimes the Shutdown hooks that shall kill the subprocess are run, sometimes not.\r\n\r\nI've tried to write a -javaagent for the maven build that patches the org.codehaus.classworlds.Launcher class (main class of the build JVM) to spawn a Thread that just listens on a port and when the connection is established, kills itself with System.exit().\r\nThat seems to exhibit the same behaviour as sending signals. The build jvm is shutdown, the shutdown hooks are run, but the forked test JVM keeps running. I suspect it's caused by the (IMHO dubious) execution of \"sh -c cd <workdir>&& java -cp <cp> <mainclass>\". What purpose does the shell wrapping and  cd command execution serve?\r\n\r\nnetbeans integration issue that is related to this problem.\r\nhttp://www.netbeans.org/issues/show_bug.cgi?id=135475","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=mkleint","name":"mkleint","emailAddress":"mkleint@codehaus.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Milos Kleint","active":true},"created":"2009-03-25T15:37:55.372-0500","updated":"2009-03-25T15:37:55.372-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/54267/comment/284881","id":"284881","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=fj","name":"fj","emailAddress":"Frank.Jakop@tolina.de","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Frank Jakop","active":true},"body":"The problem is located in {{org.codehaus.plexus.util.cli.CommandLineUtils.executeCommandLineAsCallable(Commandline, InputStream, StreamConsumer, StreamConsumer, int)}}.\r\n\r\nIf you replace the line \r\n{noformat}\r\nfinal Process p = cl.execute();\r\n{noformat}\r\n, which executes the process (notepad) with {{cmd.exe}} with a direct execution like \r\n{noformat}\r\nProcess pr = null;\r\n  try \\{\r\n    pr = Runtime.getRuntime().exec(cl.getCommandline(), cl.getEnvironmentVariables(), cl.getWorkingDirectory());\r\n  } catch (IOException e) {\r\n  throw new CommandLineException(\"Failed to start process\", e);\r\n  }\r\n\r\n  final Process p = pr;\r\n{noformat}\r\n\r\ntermination behaviour works as expected, at least, if notepad does not start child processe ;)\r\n","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=fj","name":"fj","emailAddress":"Frank.Jakop@tolina.de","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Frank Jakop","active":true},"created":"2011-12-05T00:51:44.964-0600","updated":"2011-12-05T00:51:44.964-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/54267/comment/341281","id":"341281","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jan.sievers","name":"jan.sievers","emailAddress":"jan.sievers@sap.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jan Sievers","active":true},"body":"{quote}\r\nI suspect it's caused by the (IMHO dubious) execution of \"sh -c cd <workdir>&& java -cp <cp> <mainclass>\". What purpose does the shell wrapping and cd command execution serve?\r\n{quote}\r\n\r\nI guess the shell cd command is an ancient workaround for pre- JDK 1.3 times when the [java.lang.Runtime.exec(...)|http://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html]  methods did not have a File workingDir parameter yet.\r\nYou can check the @since 1.3 annotations of the methods. Apache commons-exec still has the [same workaround in the code| http://svn.apache.org/viewvc/commons/proper/exec/trunk/src/main/java/org/apache/commons/exec/launcher/WinNTCommandLauncher.java?view=markup] but it's no longer used. Actual [implementation uses JDK >= 1.3| http://svn.apache.org/viewvc/commons/proper/exec/trunk/src/main/java/org/apache/commons/exec/launcher/Java13CommandLauncher.java?view=markup].\r\n\r\nIn a similar [tycho bug|https://bugs.eclipse.org/bugs/show_bug.cgi?id=427556], the intermediate shell was the root cause and omitting it (by using commons-exec) fixed the problem.\r\n","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=jan.sievers","name":"jan.sievers","emailAddress":"jan.sievers@sap.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Jan Sievers","active":true},"created":"2014-02-12T07:52:38.189-0600","updated":"2014-02-12T07:52:38.189-0600"}]},"timeoriginalestimate":null,"aggregatetimespent":null}}